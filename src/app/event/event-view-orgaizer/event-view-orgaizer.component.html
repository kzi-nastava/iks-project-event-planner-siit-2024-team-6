<div class="event-view">
  <div class="grid-container">
    <!-- Block 1: Photos and Add to Favorites -->
    <div class="block block-1">
      <div class="event-image">
        <div class="image-carousel">
          <button (click)="prevPhoto()" class="carousel-button prev">&lt;</button>
          <img [src]="event?.photos[currentPhotoIndex]" alt="Event Image" />
          <button (click)="nextPhoto()" class="carousel-button next">&gt;</button>
        </div>
      </div>

      <!-- Organizer Container -->
      <div class="organizer-container">
        <div class="organizer-info">
          <div class="organizer-icon">
            <i class="fa fa-user-circle icon"></i>
          </div>
          <div class="organizer-details">
            <p>{{ organizer?.name || 'Organizer' }}</p>
            <p>{{ organizer?.phoneNumber || 'Phone number not available' }}</p>
          </div>
        </div>
<div class="add-fav" (click)="toggleFavorite()">
  <!-- Outlined heart SVG -->
  <svg *ngIf="!isFavorite" class="heart-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
    stroke="#8B6A9D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path
      d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 21l7.8-7.8 1-1a5.5 5.5 0 0 0 0-7.8z" />
  </svg>

  <!-- Filled heart SVG -->
  <svg *ngIf="isFavorite === true" class="heart-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
    fill="#8B6A9D">
    <path
      d="M19.3,5.71C18.841,5.246 18.294,4.878 17.692,4.627C17.089,4.377 16.443,4.248 15.79,4.25C15.137,4.248 14.491,4.377 13.888,4.627C13.286,4.878 12.739,5.246 12.28,5.71L12,6L11.72,5.72C10.792,4.792 9.533,4.27 8.22,4.27C6.907,4.27 5.648,4.792 4.72,5.72C3.804,6.655 3.291,7.911 3.291,9.22C3.291,10.529 3.804,11.785 4.72,12.72L11.49,19.51C11.631,19.65 11.821,19.729 12.02,19.729C12.219,19.729 12.409,19.65 12.55,19.51L19.32,12.72C20.236,11.782 20.748,10.522 20.744,9.211C20.74,7.9 20.222,6.642 19.3,5.71Z" />
  </svg>
</div>
      </div>

      <!-- Photo Management -->
      <div class="photo-management">
        <h2>Photos</h2>
        <div class="photo-list">
          <div *ngFor="let photo of event?.photos; let i = index" class="photo-item">
            <img [src]="photo" alt="Event Photo" />
            <button (click)="removePhoto(i)" class="delete-photo-btn">Delete</button>
          </div>
        </div>
        <div class="add-photo">
          <input type="text" [(ngModel)]="newPhotoUrl" placeholder="Enter photo URL" />
          <button (click)="addPhoto()" class="add-photo-btn">Add Photo</button>

        </div>
      </div>

    </div>
    <!-- Block 2: Editable Event Details -->
    <div class="block block-2">
      <p>
        <input type="text" [(ngModel)]="event.name" placeholder="Event Name" class="editable-field" />
      </p>
      <div class="event-info">
        <p style="font-weight: bold; font-style: italic;">
          <i class="fa-solid fa-align-justify"></i> Description
        </p>
        <textarea [(ngModel)]="event.description" placeholder="Enter event description"></textarea>

        <p style="font-weight: bold; font-style: italic;">
          <i class="fa-solid fa-location-dot"></i> Where
        </p>
        <input type="text" [(ngModel)]="event.place" placeholder="Enter location" />

        <p style="font-weight: bold; font-style: italic;">
          <i class="fa-solid fa-user-group"></i> Max participants:
        </p>
        <input type="text" [(ngModel)]="event.maxParticipants" placeholder="Enter max participants" />

        <p style="font-weight: bold; font-style: italic;">
          <i class="fa-regular fa-calendar"></i> When
        </p>
        <p style="font-weight:lighter; font-style: italic; font-size: small;">{{ event?.date|date:'fullDate' }}</p>
        <input type="date" [(ngModel)]="event.date" />
      </div>
      <div class="event-actions">
        <button (click)="saveChanges()" class="save-button">Save changes</button>
        <button *ngIf="event?.isDeleted" (click)="activateEvent()" class="activate-button">
          Activate
        </button>

        <!-- Условие: Если isDeleted = false -->
        <button *ngIf="!event?.isDeleted" (click)="deleteEvent()" class="delete-button">
          Delete event
        </button>
        <button *ngIf="event?.date && isFutureDate(event.date)" class="btn-budget" (click)="openBudgetPlanning()">
          Budget
        </button>

      </div>
    </div>

    <!-- Block 3: Agenda and Reviews -->
    <div class="block block-3">
      <h3>Festival agenda</h3>
      <button (click)="openAgengda()" class="delete-button">Manage agenda</button>

      <p *ngIf="!statisticsData">Loading statistics...</p>
<div *ngIf="statisticsData">
  <p>Statistics graph for "{{ event.name }}"</p>
  <canvas id="eventChart"></canvas>
</div>

      <p *ngIf="!statisticsReady" class="loading-text">Generating statistics PDF...</p>
      <button *ngIf="statisticsReady" (click)="downloadEventStatisticsPDF()" class="download-btn">
        Download statistics
      </button>

    </div>

    <!-- Block 4: Map -->
    <div class="block block-4">
      <h3 class="map-title">Show on map</h3>
      <iframe width="100%" height="350" [src]="mapUrl" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
    </div>
  </div>
</div>